name: Ejecutar Criba Nocturna

on: workflow_dispatch  # Botón manual

jobs:
  buscando-gangas:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 horas máximo

    steps:
    - name: Descargar tu repositorio
      uses: actions/checkout@v3

    - name: Instalar Python 3.12
      uses: actions/setup-python@v4
      with:
        python-version: '3.12' 

    - name: Instalar librerías
      run: pip install pandas yfinance tqdm lxml requests

    # OJO: Asegúrate de que tu archivo se llama así en el repo
    - name: EJECUTAR TU SCRIPT
      run: python criba_empresas.py

    # --- PASO DE SEGURIDAD: VER QUÉ SE HA CREADO ---
    - name: Listar archivos generados (Debug)
      if: always()
      run: ls -R
    # -----------------------------------------------

    - name: Guardar TODOS los CSV resultantes
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: RESULTADOS_FINALES
        path: "*.csv"
        if-no-files-found: warn